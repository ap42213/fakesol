FROM node:20-slim

WORKDIR /app/server

# Install server dependencies (includes tsx)
COPY server/package*.json ./
RUN npm install

# Copy server source
COPY server/ ./

# Some platforms/services run commands from /app/server but still reference paths like
# `server/scripts/...` (as if the CWD were /app). Provide a compatible alias.
RUN ln -s . server

# Run refill script
CMD ["npx", "tsx", "scripts/refillTreasury.ts"]
